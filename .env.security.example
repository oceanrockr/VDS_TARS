# T.A.R.S. Security Configuration
# Phase 11.5 - Authentication, Authorization, TLS, and Rate Limiting
# Copy to .env and fill in the values

# ============================================================================
# JWT Authentication
# ============================================================================
# Generate with: openssl rand -base64 32
JWT_SECRET=your-secret-key-here-change-me
JWT_ALGORITHM=HS256
JWT_EXPIRY_MINUTES=60
REFRESH_EXPIRY_DAYS=7

# ============================================================================
# API Keys (Service-to-Service Authentication)
# ============================================================================
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
AUTOML_API_KEY=
HYPERSYNC_API_KEY=
ORCHESTRATION_API_KEY=
DASHBOARD_API_KEY=

# ============================================================================
# Rate Limiting
# ============================================================================
USE_REDIS=true
REDIS_URL=redis://localhost:6379

# Rate limits (requests per minute)
PUBLIC_RATE_LIMIT=30
AUTH_RATE_LIMIT=10

# ============================================================================
# TLS / mTLS Configuration
# ============================================================================
# Enable TLS for services
TLS_ENABLED=true

# Certificate paths (for local development)
TLS_CERT_PATH=./certs/server.crt
TLS_KEY_PATH=./certs/server.key
TLS_CA_PATH=./certs/ca.crt

# mTLS (mutual TLS for service-to-service)
MTLS_ENABLED=true
MTLS_STRICT_MODE=false  # Set to true in production

# ============================================================================
# Service URLs (with TLS)
# ============================================================================
ORCHESTRATION_SERVICE_URL=https://localhost:8094
AUTOML_SERVICE_URL=https://localhost:8097
HYPERSYNC_SERVICE_URL=https://localhost:8098
DASHBOARD_API_URL=https://localhost:3001

# ============================================================================
# RBAC Configuration
# ============================================================================
# Enable role-based access control
RBAC_ENABLED=true

# ============================================================================
# HyperSync Approval Mode
# ============================================================================
# Options: manual, autonomous_threshold, autonomous_all
APPROVAL_MODE=manual
AUTONOMOUS_THRESHOLD=0.03
VALIDATION_STRICTNESS=medium

# ============================================================================
# Agent Hyperparameters (Orchestration Service)
# ============================================================================
# DQN (Policy Agent)
DQN_LEARNING_RATE=0.001
DQN_GAMMA=0.95
DQN_BATCH_SIZE=64
DQN_BUFFER_SIZE=10000
DQN_USE_DUELING=false

# A2C (Consensus Agent)
A2C_LEARNING_RATE=0.0007
A2C_GAMMA=0.99
A2C_GAE_LAMBDA=0.95

# PPO (Ethical Agent)
PPO_LEARNING_RATE=0.0003
PPO_GAMMA=0.99
PPO_CLIP_EPSILON=0.2
PPO_N_EPOCHS=10

# DDPG (Resource Agent)
DDPG_ACTOR_LR=0.0001
DDPG_CRITIC_LR=0.001
DDPG_GAMMA=0.99
DDPG_TAU=0.005

# ============================================================================
# Global Reward Weights
# ============================================================================
REWARD_W_POLICY=0.30
REWARD_W_CONSENSUS=0.25
REWARD_W_ETHICAL=0.25
REWARD_W_RESOURCE=0.20

# ============================================================================
# Nash Equilibrium Solver
# ============================================================================
NASH_METHOD=iterative_br
NASH_MAX_ITER=1000
NASH_TOLERANCE=1e-6

# ============================================================================
# Pareto Frontier
# ============================================================================
PARETO_EPSILON=1e-6

# ============================================================================
# AutoML Configuration
# ============================================================================
AUTOML_ENABLED=true
OPTUNA_N_TRIALS=100
FEATURETOOLS_DEPTH=2
MLFLOW_TRACKING_URI=./mlruns

# ============================================================================
# Logging
# ============================================================================
LOG_LEVEL=INFO
LOG_FORMAT=json  # json or text

# ============================================================================
# Metrics & Monitoring
# ============================================================================
PROMETHEUS_ENABLED=true
PROMETHEUS_PORT=9090

# ============================================================================
# Database (if using PostgreSQL instead of Redis)
# ============================================================================
DATABASE_URL=postgresql://user:password@localhost:5432/tars
DATABASE_POOL_SIZE=10
DATABASE_MAX_OVERFLOW=20

# ============================================================================
# CORS Configuration
# ============================================================================
CORS_ENABLED=true
CORS_ORIGINS=http://localhost:3000,https://tars.local
CORS_ALLOW_CREDENTIALS=true

# ============================================================================
# Production Settings
# ============================================================================
ENVIRONMENT=production  # development, staging, production
DEBUG=false
TESTING=false

# ============================================================================
# Kubernetes Deployment
# ============================================================================
# Namespace
K8S_NAMESPACE=tars

# Image registry
IMAGE_REGISTRY=ghcr.io/tars-ai
IMAGE_TAG=0.9.5-alpha
IMAGE_PULL_POLICY=IfNotPresent

# Ingress
INGRESS_ENABLED=true
INGRESS_CLASS=nginx
INGRESS_HOST=tars.local

# Cert-manager
CERT_MANAGER_ENABLED=true
CERT_ISSUER=tars-ca-issuer  # or tars-letsencrypt-prod

# ============================================================================
# Security Hardening
# ============================================================================
# Disable demo users in production
DEMO_USERS_ENABLED=false

# Force HTTPS redirect
FORCE_HTTPS=true

# Security headers
HSTS_ENABLED=true
HSTS_MAX_AGE=31536000

# Content Security Policy
CSP_ENABLED=true

# ============================================================================
# Backup & Recovery
# ============================================================================
BACKUP_ENABLED=false
BACKUP_SCHEDULE="0 2 * * *"  # Daily at 2 AM
BACKUP_RETENTION_DAYS=30

# ============================================================================
# Feature Flags
# ============================================================================
FEATURE_AUTOML=true
FEATURE_HYPERSYNC=true
FEATURE_DASHBOARD=true
FEATURE_METRICS=true
